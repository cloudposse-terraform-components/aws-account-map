# Atmos Configuration â€” powered by https://atmos.tools
#
# This configuration enables centralized, DRY, and consistent project scaffolding using Atmos.
#
# Included features:
# - Organizational custom commands: https://atmos.tools/core-concepts/custom-commands
# - Automated README generation: https://atmos.tools/cli/commands/docs/generate
#
# Import shared configuration used by all modules
import:
  - https://raw.githubusercontent.com/cloudposse-terraform-components/.github/refs/heads/main/.github/atmos/terraform-component.yaml

docs:
  generate:
    readme-submodule-iam-roles:
      base-dir: ./
      input:
        - readme: "./src/modules/iam-roles/README.md"
        - get_support: true
      template: "https://raw.githubusercontent.com/cloudposse-terraform-components/.github/refs/heads/main/atmos.README.md.submodule.gotmpl"
      output: "./src/modules/iam-roles/README.md"
      terraform:
        source: ./src/modules/iam-roles
        enabled: true
        format: "markdown table"
        show_providers: false
        show_inputs: true
        show_outputs: true
        sort_by: "name"
        hide_empty: false
        indent_level: 2

    readme-submodule-roles-to-principals:
      base-dir: ./
      input:
        - readme: "./src/modules/roles-to-principals/README.md"
        - get_support: true
      template: "https://raw.githubusercontent.com/cloudposse-terraform-components/.github/refs/heads/main/atmos.README.md.submodule.gotmpl"
      output: "./src/modules/roles-to-principals/README.md"
      terraform:
        source: ./src/modules/roles-to-principals
        enabled: true
        format: "markdown table"
        show_providers: false
        show_inputs: true
        show_outputs: true
        sort_by: "name"
        hide_empty: false
        indent_level: 2

    readme-submodule-team-assume-role-policy:
      base-dir: ./
      input:
        - readme: "./src/modules/team-assume-role-policy/README.md"
        - get_support: true
      template: "https://raw.githubusercontent.com/cloudposse-terraform-components/.github/refs/heads/main/atmos.README.md.submodule.gotmpl"
      output: "./src/modules/team-assume-role-policy/README.md"
      terraform:
        source: ./src/modules/team-assume-role-policy
        enabled: true
        format: "markdown table"
        show_providers: false
        show_inputs: true
        show_outputs: true
        sort_by: "name"
        hide_empty: false
        indent_level: 2

commands:
- name: readme
  steps:
    - "atmos docs generate readme"
    - "atmos docs generate readme-simple"
    - "atmos docs generate readme-submodule-iam-roles"
    - "atmos docs generate readme-submodule-roles-to-principals"
    - "atmos docs generate readme-submodule-team-assume-role-policy"

- name: test
  commands:
  - name: "deploy"
    description: Deploy
    commands:
      - name: "dependencies"
        description: Deploy dependencies only
        steps:
          - "cd test"
          - "go test -timeout 1h --only-deploy-dependencies --skip-destroy-dependencies"

      - name: "component"
        description: Deploy component only
        steps:
          - "cd test"
          - "go test -timeout 1h --skip-deploy-dependencies --skip-destroy-dependencies --skip-destroy-component"

  - name: "assert"
    description: Run asserts
    steps:
      - "cd test"
      - "go test -timeout 1h --skip-deploy-dependencies --skip-destroy-dependencies --skip-deploy-component --skip-destroy-component"

  - name: "destroy"
    description: Destroy
    steps:
      - "cd test"
      - "go test -timeout 1h --skip-deploy-dependencies --skip-deploy-component"

  - name: "run"
    description: Run tests
    steps:
      - "cd test"
      - "go test -timeout 1h"
